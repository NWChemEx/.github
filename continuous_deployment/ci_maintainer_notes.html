<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How NWX’s Continuous Integration (CI) Works &mdash; Developer Documentation 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Documentation Deployment" href="documentation.html" />
    <link rel="prev" title="Continuous Deployment" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Developer Documentation
          </a>
              <div class="version">
                1.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">NWChemEx Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/index.html">Design Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documenting/index.html">Documenting NWChemEx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conventions/index.html">NWChemEx Organization Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coding/index.html">Developing NWChemEx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">Testing NWChemEx</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Continuous Deployment</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">How NWX’s Continuous Integration (CI) Works</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#common-and-repo-specific-workflows">Common and Repo-Specific Workflows</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ci-coverage">CI coverage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#common-pull-request-workflow">Common Pull Request Workflow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#common-merge-workflow">Common Merge Workflow</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#nwx-build-environment-image">NWX Build Environment Image</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="documentation.html">Documentation Deployment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../resources/index.html">Additional Developer Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography/bibliography.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Developer Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Continuous Deployment</a></li>
      <li class="breadcrumb-item active">How NWX’s Continuous Integration (CI) Works</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/NWChemEx/.github/edit/master/docs/source/continuous_deployment/ci_maintainer_notes.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="how-nwx-s-continuous-integration-ci-works">
<h1>How NWX’s Continuous Integration (CI) Works<a class="headerlink" href="#how-nwx-s-continuous-integration-ci-works" title="Permalink to this heading"></a></h1>
<p>The purpose of this page is to document various aspects of NWX’s CI.</p>
<p>NWX has a lot of repositories. And more repositories will be added into NWX. To
make the CI of NWX generic and re-useable, we’ve used <a class="reference external" href="https://docs.github.com/en/actions/using-workflows/reusing-workflows">reuseable workflows</a> and
<a class="reference external" href="https://docs.github.com/en/actions/creating-actions/creating-a-composite-action">composite actions</a>
for designing our CI architecture. The goal of this design was to ensure
maximum re-use of CI components across multiple repositories.</p>
<p>Here are a few useful tutorials on workflows in GitHub:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.github.com/en/actions/quickstart">Quickstart for GitHub Actions</a></p></li>
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=TLB5MY9BBa4">GitHub Actions Tutorial, From Zero to Hero in 90 minutes</a></p></li>
</ul>
<p>Currently the following repositories in <code class="docutils literal notranslate"><span class="pre">NWChemEx</span></code> follow the methods
outlined here:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ChemCache</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Chemist</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.github</span></code> (This is our configuration repository)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Integrals</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Mokup</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NWChemEx</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ParallelZone</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PluginPlay</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SimDE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCF</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TensorWrapper</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Utilities</span></code></p></li>
</ol>
<div class="section" id="common-and-repo-specific-workflows">
<h2>Common and Repo-Specific Workflows<a class="headerlink" href="#common-and-repo-specific-workflows" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">.github/workflow</span></code> directory in the <code class="docutils literal notranslate"><span class="pre">NWChemEx/.github</span></code> repo
houses both the set of workflows specific to the <code class="docutils literal notranslate"><span class="pre">.github</span></code> repo and the set
of reusable workflows that should be used throughout the NWX stack. Generally,
these reusable workflows should be named as <code class="docutils literal notranslate"><span class="pre">common_{trigger</span> <span class="pre">event}.yaml</span></code>,
where <code class="docutils literal notranslate"><span class="pre">{trigger</span> <span class="pre">event}</span></code> can be <code class="docutils literal notranslate"><span class="pre">pull_request</span></code>, <code class="docutils literal notranslate"><span class="pre">merge</span></code>, or other <a class="reference external" href="https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows">workflow
triggering events</a>.
These common workflows aggregrate the reoccurring jobs required by the NWX repos
when a given event occurs, e.g applying formatting and testing changes to files
in a pull request. The common workflows for pull requests and merging changes
are discussed more specifically below.</p>
<p>Aside from the common workflows, there are the repo-specific workflows with the
naming convention <code class="docutils literal notranslate"><span class="pre">{trigger</span> <span class="pre">event}.yaml</span></code>. Where needed, a version of these
workflows can be added in each repo. Here’s an example of a repo-specific
<code class="docutils literal notranslate"><span class="pre">pull_request.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">Common-Pull-Request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NWChemEx/.github/.github/workflows/common_pull_request.yaml@master</span>
<span class="w">    </span><span class="nt">with</span><span class="p">:</span>
<span class="w">      </span><span class="nt">config_file</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="w">      </span><span class="nt">source_dir</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="w">      </span><span class="nt">compilers</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="w">      </span><span class="nt">doc_target</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Sphinx&#39;</span>
<span class="w">    </span><span class="nt">secrets</span><span class="p">:</span>
<span class="w">      </span><span class="nt">CMAIZE_GITHUB_TOKEN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.CMAIZE_GITHUB_TOKEN }}</span>
<span class="w">  </span><span class="nt">Unique-Job</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Other steps unique to the individual repos can be added as Jobs</span>
</pre></div>
</div>
<p>Generally, these workflows are expected to call to the corresponding reusable
workflow to handle the reoccurring task and then locally implement any unique
automations.</p>
</div>
<div class="section" id="ci-coverage">
<h2>CI coverage<a class="headerlink" href="#ci-coverage" title="Permalink to this heading"></a></h2>
<div class="section" id="common-pull-request-workflow">
<h3>Common Pull Request Workflow<a class="headerlink" href="#common-pull-request-workflow" title="Permalink to this heading"></a></h3>
<p>The common workflow for pull requests first handles the addition of any license
headers to files and runs clang formatting. NWChemEx uses <a class="reference external" href="https://www.apache.org/licenses/LICENSE-2.0">Apache License (2.0)</a>. We want all our source code
(except for some configuration, test and input files) to have the proper license
header when deployed. The licensing setting are configured by the
<code class="docutils literal notranslate"><span class="pre">.licenserc.yaml</span></code> file in each repo’s <code class="docutils literal notranslate"><span class="pre">.github</span></code> directory. For details on
this files construction, see <a class="reference external" href="https://github.com/apache/skywalking-eyes/tree/v0.4.0">here</a></p>
<p>If there are changes resulting from these first steps, they will be pushed to
the branch and the workflow will end. The new commit resulting from this step
should then re-trigger the origin workflow, ensuring that the new changes are
included in the following steps. If changes were not made by the license and
formatting step, the workflow continues on to attempt to build the current
library and its documentation. If the library builds properly, it’s test suite
is also run.</p>
</div>
<div class="section" id="common-merge-workflow">
<h3>Common Merge Workflow<a class="headerlink" href="#common-merge-workflow" title="Permalink to this heading"></a></h3>
<p>The common workflow for merging a successful pull request applies the correct
version tag to the resulting commit and deployes the repo’s documentation to
GitHub Pages.</p>
</div>
</div>
<div class="section" id="nwx-build-environment-image">
<h2>NWX Build Environment Image<a class="headerlink" href="#nwx-build-environment-image" title="Permalink to this heading"></a></h2>
<p>To avoid rebuilding costly dependencies for the various repos in the NWX stack,
the building and testing steps in the common workflows run in containers built
on the image <code class="docutils literal notranslate"><span class="pre">ghcr.io/nwchemex/nwx_buildenv:latest</span></code>. This image
defines an Ubuntu based environment where the various dependencies of the stack
(such as compilers, math libraries, MPI, and other C++ libraries outside) have
been pre-installed. The files used to build this image are found in
<code class="docutils literal notranslate"><span class="pre">NWChemEx/.github/nwx_build_environment</span></code>, along side the
<code class="docutils literal notranslate"><span class="pre">buildenv.sh</span></code> script which builds the image through consecutive Docker calls.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Continuous Deployment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="documentation.html" class="btn btn-neutral float-right" title="Documentation Deployment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, NWChemEx Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>