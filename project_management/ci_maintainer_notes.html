<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How NWX’s CI Works &mdash; DeveloperTools 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Documentation Deployment" href="documentation.html" />
    <link rel="prev" title="Project Management" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> DeveloperTools
          </a>
              <div class="version">
                1.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../conventions/index.html">Project Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/index.html">Design Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Developing NWChemEx</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Project Management</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">How NWX’s CI Works</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#file-synchronization">File Synchronization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-workflows">Writing Workflows</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installing-dependencies">Installing Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-the-repo">Building the Repo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testing-and-deploying-documentation">Testing and Deploying Documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#linting">Linting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#adding-a-new-repo">Adding a New Repo</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="documentation.html">Documentation Deployment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../resources/index.html">Additional Developer Resources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DeveloperTools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Project Management</a> &raquo;</li>
      <li>How NWX’s CI Works</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/project_management/ci_maintainer_notes.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="how-nwx-s-ci-works">
<h1>How NWX’s CI Works<a class="headerlink" href="#how-nwx-s-ci-works" title="Permalink to this heading"></a></h1>
<p>The purpose of this page is to document various aspects of NWX’s CI.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>NWX’s CI uses GitHub actions. GitHub actions allows you to have one or more
workflows which get executed upon certain triggers. The workflows themselves are
YAML and are a bit hard to write in a generic manner. This leads to copy/pasting
these YAML files across repos and then making repo-specific changes to the copy
pasted file. This is hard to maintain and leads to several sources of truth. Our
solution is to write several generic Bash scripts which encapsulate how we do
various CI steps (e.g., get a dependency or build documentation). The YAML files
are then written by calling these scripts with the repo-specific options. We
rely on file synchronization to keep the Bash scripts consistent across repos
(the master versions live here in the DeveloperTools repo).</p>
</section>
<section id="file-synchronization">
<h2>File Synchronization<a class="headerlink" href="#file-synchronization" title="Permalink to this heading"></a></h2>
<p>There are several files which need to appear in each NWX repo and whose content
needs to be synchronized. This includes:</p>
<ul class="simple">
<li><p>.github/workflows/scripts/build_docs.sh</p></li>
<li><p>.github/workflows/scripts/get_dependencies.sh</p></li>
<li><p>.github/workflows/scripts/lint.sh</p></li>
<li><p>.clang-format</p></li>
<li><p>.gitignore</p></li>
<li><p>LICENSE</p></li>
</ul>
<p>Rather than remembering to update these files in each repo anytime they change,
we rely on the
<a href="#id2"><span class="problematic" id="id3">`Files Sync Action&lt;https://github.com/marketplace/actions/files-sync-action&gt;`_</span></a>
to keep them synchronized. Synchronizing these files is done in the
SynchronizeFiles workflow (YAML file: <code class="docutils literal notranslate"><span class="pre">.github/workflows/synch_files.yaml</span></code>).
This workflow is executed when a DeveloperTools PR is merged into master.</p>
</section>
<section id="writing-workflows">
<h2>Writing Workflows<a class="headerlink" href="#writing-workflows" title="Permalink to this heading"></a></h2>
<p>The YAML workflows are written in terms of several Bash scripts. The scripts are
separated into several generic tasks.</p>
<section id="installing-dependencies">
<h3>Installing Dependencies<a class="headerlink" href="#installing-dependencies" title="Permalink to this heading"></a></h3>
<p>All logic for installing dependencies is maintained in the
<cite>workflows/scripts/get_dependencies.sh</cite> script. This script takes a list of
dependencies to install and installs them. The GitHub workflows should get their
dependencies by calling this script. This script will be invoked by many of the
YAML workflows.</p>
</section>
<section id="building-the-repo">
<h3>Building the Repo<a class="headerlink" href="#building-the-repo" title="Permalink to this heading"></a></h3>
<p>Logic encapsulating the configure, build, and test phases is maintained in the
<cite>workflows/scripts/build_and_test.sh</cite> script. This script will generate a CMake
toolchain file, use that file to configure the build, actually build the repo,
run the unit tests (through ctest), and finally process the coverage results.</p>
</section>
<section id="testing-and-deploying-documentation">
<h3>Testing and Deploying Documentation<a class="headerlink" href="#testing-and-deploying-documentation" title="Permalink to this heading"></a></h3>
<p>Most of the NWChemEx repos use a two-pronged approach to documentation where the
C++ documentation is documented using Doxygen and the non-API documentation is
written using Sphinx. The <cite>.github/workflows/scripts/build_docs.sh</cite> script
encapsulates this process. Each repo is responsible for maintaining two YAML
files. The first YAML file should install the documentation dependencies
(<cite>doxygen</cite> and <cite>sphinx</cite>) and then call <cite>build_docs.sh</cite>. This should be done for
every PR in order to ensure the PR does not break the documentation. The second
YAML file also installs the dependencies and builds the documentation.
Additionally this YAML file deploys the documentation to GitHub Pages. The
second YAML</p>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Can we combine the two YAML files so that the last step (deployment) is
only done when we’re pushing to master?</p>
</div>
</section>
<section id="linting">
<h3>Linting<a class="headerlink" href="#linting" title="Permalink to this heading"></a></h3>
<p>Linting of the C++ source code is done with clang-format (specifically version
9). The <cite>.github/workflows/scripts/lint.sh</cite> script actually executes the
linting. The workflow YAML file is responsible for installing clang-format, for
calling <cite>lint.sh</cite>, and for making a PR from the diff.</p>
</section>
</section>
<section id="adding-a-new-repo">
<h2>Adding a New Repo<a class="headerlink" href="#adding-a-new-repo" title="Permalink to this heading"></a></h2>
<p>To add another repo to NWX’s CI follow these steps.</p>
<ol class="arabic simple">
<li><p>Add the repo to <cite>synch_files.yaml</cite> so that it gets the synchronized files</p></li>
<li><p>Commit that change (once it’s merged that should trigger the synchronization)</p></li>
<li><p>Add workflow files for the CI actions you are interested in
- Easiest way is by copy/pasting from another NWX repo</p></li>
<li><p>Note that the repo must not enforce branch protection rules for admins
otherwise the synch files plugin can’t push the synched files.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Project Management" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="documentation.html" class="btn btn-neutral float-right" title="Documentation Deployment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, NWChemEx Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>